<!DOCTYPE html>
<meta charset="utf-8">
<style>
    path {
        stroke: white;
        stroke-width: 0.25px;
        fill: grey;
    }
    circle {
        fill: rgba(255, 0, 0, 0.5);
    }
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v0.min.js"></script>
<script>
    var width = 1360,
            height = 500;

    var projection = d3.geo.mercator()
            .center([0, 5 ])
            .scale(150)
            .rotate([-180,0]);

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

    var path = d3.geo.path()
            .projection(projection);

    var g = svg.append("g");

    var rColumn = "mag";
    var rScale = d3.scale.sqrt();
    var tScale = d3.time.scale();
    // load and display the World
    d3.json("world-110m2.json", function(error, topology) {

// load and display the cities
        d3.csv("earthquake.csv", function(error, data) {

            rScale.domain(d3.extent(data, function (d){ return +d[rColumn]; }));
            var rMin = 3;
            var rMax = 10;
            rScale.range([rMin, rMax]);

            tScale.domain(d3.extent(data,function (d){ return new Date(d["time"]);}))
                    .range([0,20e3]);

            var dots =g.selectAll("circle")
                        .data(data);
            dots.enter().append("circle");
            dots.attr("cx", function(d) {
                return projection([d["longitude"], d["latitude"]])[0];
            }).attr("cy", function(d) {
                return projection([d["longitude"], d["latitude"]])[1];
            });
            dots.transition().duration(1e3)
                    .delay(function (d){ return tScale(new Date(d["time"])); })
                    .attr("r", function (d){ return rScale(d[rColumn]); });
            dots.exit().remove();
        });


        g.selectAll("path")
                .data(topojson.object(topology, topology.objects.countries)
                        .geometries)
                .enter()
                .append("path")
                .attr("d", path)
    });

    // zoom and pan
    var zoom = d3.behavior.zoom()
            .on("zoom",function() {
                g.attr("transform","translate("+
                        d3.event.translate.join(",")+")scale("+d3.event.scale+")");
                g.selectAll("circle")
                        .attr("d", path.projection(projection));
                g.selectAll("path")
                        .attr("d", path.projection(projection));

            });

    svg.call(zoom)

</script>
<script>
    function nextPage(){
        window.location='fracking_vs_earthquakes.html';
    }
</script>
<button onclick="nextPage();">Continue</button>
</body>
</html>