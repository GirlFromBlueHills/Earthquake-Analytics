<!DOCTYPE html>
<meta charset="utf-8">
<style>
    path {
        stroke: white;
        stroke-width: 0.25px;
        fill: grey;
    }
    circle {
        fill: rgba(255, 0, 0, 0.5);
    }
    ellipse{
        fill: rgba(0,200,255,0.3);
    }
    .mesh {
        fill: none;
        stroke: lightgrey;
        stroke-width: 2px;
        stroke-linejoin: round;
    }

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>

    var width = 1360,
            height = 800;

    var projection = d3.geo.mercator()
            .center([-120, 60 ])
            .scale(500);


    var radius = d3.scale.sqrt()
            .domain([0, 1e6])
            .range([0, 10]);

    var path = d3.geo.path()
            .projection(projection);

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

    var rColumn = "mag";
    var rScale = d3.scale.sqrt();
    var tScale = d3.time.scale();

    d3.json("us.json", function(error, topology) {
        states = topojson.feature(topology, topology.objects.states).features

        d3.csv("earthquake_usa.csv", function(error, data) {

            rScale.domain(d3.extent(data, function (d){ return +d[rColumn]; }));
            var rMin = 3;
            var rMax = 10;
            rScale.range([rMin, rMax]);

            tScale.domain(d3.extent(data,function (d){ return new Date(d["time"]);}))
                    .range([0,20e3]);

            var dots =svg.selectAll("circle")
                    .data(data);
            dots.enter().append("circle");
            dots.attr("cx", function(d) {
                return projection([d["longitude"], d["latitude"]])[0];
            }).attr("cy", function(d) {
                return projection([d["longitude"], d["latitude"]])[1];
            });
            dots.transition().duration(1e3)
                    .delay(function (d){ return tScale(new Date(d["time"])); })
                    .attr("r", function (d){ return rScale(d[rColumn]); })


            dots.exit().remove();
        });
        d3.csv("fracking_clean.csv", function(error, data) {


            var area =svg.selectAll("ellipse")
                    .data(data);
            area.enter().append("ellipse");
            area.attr("cx", function(d) {
                return projection([d["longitude"], d["latitude"]])[0];
            }).attr("cy", function(d) {
                return projection([d["longitude"], d["latitude"]])[1];
            }).attr("rx",2).attr("ry",2);



            area.exit().remove();
        });


        svg.selectAll("path")
                .data(states)
                .enter()
                .append("path")
                .attr("class", "feature")
                .style("fill", "gray")
                .attr("d", path)

        svg.append("path")
                .datum(topojson.mesh(topology, topology.objects.states, function(a, b) { return a !== b; }))
                .attr("class", "mesh")
                .attr("d", path);

    })
</script>
<script>
    function previousPage(){
        window.location='EarthquakeOverView.html';
    }
</script>
<button onclick="previousPage();">Back</button>
</body>
</html>